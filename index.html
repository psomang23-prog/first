<!DOCTYPE html>
<html lang="mn">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Эхлэл 1 — 클릭 시 한국어 뜻만 (mn→ko)</title>
<style>
  body{margin:0;padding:16px 16px 160px;font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans,Apple SD Gothic Neo,Malgun Gothic,Helvetica Neue,Arial,sans-serif;line-height:1.8}
  #text{white-space:pre-wrap;font-size:18px}
  .word{cursor:pointer;padding:2px 4px;border-radius:6px}
  .word:active{background:#eef}
  #defsWrap{position:fixed;left:0;right:0;bottom:0;border-top:1px solid #e5e7eb;background:#fff;padding:12px 16px;box-shadow:0 -6px 18px rgba(0,0,0,.06)}
  #defs{font-size:16px}
  #defs .def{padding:2px 0}
  #err{margin-top:8px;color:#ef4444;font-size:12px;white-space:pre-wrap}
</style>
</head>
<body>
<div id="text">로딩 중...</div>
<div id="defsWrap" hidden><div id="defs"></div><div id="err"></div></div>

<script>
(function(){
  const textData = `[1] Эхэнд Бурхан тэнгэр ба газрыг бүтээжээ. [2] Газар нь хэлбэржээгүй, хоосон төдийгүй оёоргүй гүний гадаргууд харанхуй бүрхэж, Бурханы Сүнс усны мандал дээгүүр элин хальж байлаа. [3] Тэгэхэд Бурхан —Гэрэл бий болтугай! гэж айлдсанд гэрэл бий болов. [4] Гэрэл сайн болсныг Бурхан харж, Бурхан гэрлийг харанхуйгаас салгажээ. [5] Бурхан гэрлийг өдөр гэж нэрлээд, харанхуйг шөнө гэж нэрлэлээ. Ийн үдэш болоод, өглөө болсон нь анхны өдөр. [6] Бурхан —Усны дундуур огторгуй байж, ийнхүү усыг уснаас салгатугай! гэж айлдав. [7] Бурхан ингэж огторгуйг бий болгоод, огторгуйн дээрх уснаас огторгуйн доорх усыг салгасанд ёсоор болов. [8] Бурхан огторгуйг тэнгэр гэж нэрлэжээ. Үдэш болоод, өглөө болсон нь хоёр дахь өдөр. [9] Бурхан —Тэнгэрийн доорх ус нэг дор хуримтлагдаж, ийн хуурай газар ил гартугай! гэсэнд ёсоор болжээ. [10] Бурхан хуурайг нь газар, хуримтлагдсан усыг нь далай гэж нэрлэв. Эдгээр нь сайн болсныг Бурхан харлаа. [11] Ингээд Бурхан —Газар нь ургамал ногоог буюу үрлэгч өвс ногоо, доторх үрээ газарт гөвдөг үр жимст модыг төрөл төрлөөр нь ургуултугай! гэж айлдсанд ёсоор болжээ. [12] Газар нь ийнхүү ургамал ногоог буюу үрлэгч өвс ногоо, доторх үрээ газарт гөвдөг үр жимст модыг төрөл төрлөөр нь гаргав. Эдгээр нь сайн болсныг Бурхан харлаа. [13] Үдэш болоод, өглөө болсон нь гурав дахь өдөр. [14] Тэгээд Бурхан —Өдрийг шөнөөс салгахын тулд тэнгэр огторгуйд гэрэлтүүлэгчид байх болтугай! Эдгээр нь тэмдэг, улирал, өдөр, жилийн тулд байг. [15] Тэнгэр огторгуйд гэрэлтүүлэгчид байж газар дэлхийг гийгүүлэг! гэж айлдсанд ёсоор болжээ. [16] Бурхан өдрийг захируулахаар нэг томхон гэрэлтүүлэгч, шөнийг захируулахаар арай багавтар гэрэлтүүлэгч, ийм хоёр том гэрэлтүүлэгчийг мөн оддыг бий болгов. [17] Бурхан тэдгээрээр газар дэлхийг гэрэлтүүлэхээр тэнгэр огторгуйд тавьсан нь [18] өдөр, шөнө хоёрыг захируулах бас гэрлийг харанхуйгаас салгахын тулд ажгуу. Эдгээр нь сайн болсныг Бурхан харлаа. [19] Үдэш болоод, өглөө болсон нь дөрөв дэх өдөр. [20] Бурхан —Шунган шумбагч амьд биетээр уснууд цалгилтугай, бас шувууд газар дэлхий дээгүүр, тэнгэр огторгуйн мандалд нистүгэй! гэж айлдав. [21] Ийнхүү Бурхан далай тэнгисийн аварга том амьтад ба уснаа шунган шумбагч амьд биетийг төрөл төрлөөр нь бас аливаа жигүүртэн шувуудыг төрөл төрлөөр нь бүтээв. Эдгээр нь сайн болсныг Бурхан харлаа. [22] Бурхан тэднийг ерөөн —Үржиж, олширцгоог! Далай тэнгисийн усанд дүүрцгээг! Шувууд ч газар дэлхийд олширцгоог! хэмээв. [23] Үдэш болоод, өглөө болсон нь тав дахь өдөр. [24] Бурхан —Газар дэлхий амьд биетийг төрөл төрлөөр нь буюу мал адгуус, мөлхөгчид, газрын зэрлэг амьтдыг төрөл төрлөөр нь гаргатугай! гэж айлдсанд ёсоор болжээ. [25] Бурхан ийнхүү газрын зэрлэг амьтдыг төрөл төрлөөр нь, мал адгуусыг төрөл төрлөөр нь, газраар мөлхөгч бүгдийг төрөл төрлөөр нь бий болгов. Эдгээр нь сайн болсныг Бурхан харлаа. [26] Тэгээд Бурхан —Бид дүр төрхийнхөө дагуу бидэнтэй адилхан хүнийг буй болгоё. Тэгээд тэднээр далайн загас, огторгуйн шувууд, мал адгуус, бүх газар дэлхий, газраар мөлхдөг мөлхөгч бүгдийг захируулъя гэж айлдав. [27] Ийнхүү Бурхан Өөрийнхөө дүр төрхөөр хүнийг бүтээж, Бурханы дүр төрхөөр бүтээхдээ эр эмээр нь бүтээжээ. [28] Бурхан тэднийг ерөөж —Үржиж, олширцгоог! Газар дэлхийг дүүргэж, түүнийг эзэмшицгээг! Далайн загас, огторгуйн шувууд хийгээд газар дээр хөлхөгч амьтан 모든нийг захирцгааг! гэв. [29] Бурхан —Үзэгтүн, газрын гадарга дээрх үрт өвс ногоо бүрийг, үрээ гөвдөг үр жимст мод бүгдийг Би та нарт өгнө. Тэр бүхэн та нарын хоол хүнс болно. [30] Газар дэлхийн зэрлэг амьтан 모든энд, огторгуйн шувуу 모든энд, газраар мөлхөгч 모든энд, амьтай амьсгалтай 모든энд өвс ногоо бүгдийг хоол хүнс болгож өгье гэсэнд ёсоор болжээ. [31] Өөрийнх нь буй болгосон бүгд нэн сайн болсныг Бурхан харлаа. Үдэш болоод, өглөө болсон нь зургаа дахь өдөр.`;

  const CYRILLIC = /[\u0400-\u04FF]/;
  const WORD_RE = /([\u0400-\u04FF]+)|(\s+|[^\u0400-\u04FF]+)/g;
  const SUFFIXES = ["аас","ээс","оос","өөс","руу","рүү","луу","лүү","аар","ээр","оор","өөр","тай","тэй","той","ууд","үүд","нууд","нүүд","ын","ийн","ны","ний","ыг","ийг","г","д"].sort((a,b)=>b.length-a.length);

  const textEl = document.getElementById("text");
  const defsWrap = document.getElementById("defsWrap");
  const defsEl = document.getElementById("defs");
  const errEl = document.getElementById("err");

  // Render text
  const frag = document.createDocumentFragment();
  for (const m of textData.matchAll(WORD_RE)){
    const w = m[1], other = m[2];
    if (w){
      const s = document.createElement("span");
      s.textContent = w; s.className="word"; s.onclick = ()=>onWordClick(w);
      frag.appendChild(s);
    } else frag.appendChild(document.createTextNode(other));
  }
  textEl.textContent = ""; textEl.appendChild(frag);

  function candidates(word){
    const base = word.toLowerCase();
    const set = new Set([word, base]);
    for (const suf of SUFFIXES){
      if (base.length > suf.length+1 && base.endsWith(suf)){
        set.add(base.slice(0, base.length - suf.length));
      }
    }
    return Array.from(set);
  }

  async function onWordClick(tok){
    const raw = tok.replace(/^[^\u0400-\u04FF]+|[^\u0400-\u04FF]+$/g,"").trim();
    if (!raw || !CYRILLIC.test(raw)) return;
    defsWrap.hidden = false;
    defsEl.textContent = "불러오는 중...";

    // 1) Wiktionary senses
    let senses = [];
    for (const cand of candidates(raw)){
      senses = await lookupSenses(cand);
      if (senses.length) break;
    }
    if (!senses.length){
      const guess = await wiktSearch(raw);
      if (guess) senses = await lookupSenses(guess);
    }

    // 2) Translate to Korean (either the senses list or the word itself)
    let output = [];
    if (senses.length){
      output = await Promise.all(senses.map(s => translateToKo(s)));
    }else{
      output = [await translateToKo(raw)];
    }
    defsEl.innerHTML = output.filter(Boolean).map(s=>`<div class="def">• ${escapeHtml(s)}</div>`).join("") || "뜻을 못 찾았어 😢";
  }

  async function lookupSenses(w){
    const mn = await fetchWikt(`https://mn.wiktionary.org/w/api.php?action=parse&prop=text&page=${encodeURIComponent(w)}&format=json&origin=*`, false);
    if (mn.length) return mn;
    const en = await fetchWikt(`https://en.wiktionary.org/w/api.php?action=parse&prop=text&page=${encodeURIComponent(w)}&format=json&origin=*`, true);
    return en;
  }

  async function fetchWikt(url, needMongolian){
    try{
      const r = await fetch(url, { cache: 'no-store' });
      const j = await r.json();
      const html = j?.parse?.text?.["*"] || "";
      if (!html) return [];
      let section = html;
      if (needMongolian){
        const parts = html.split(/<span[^>]*id="Mongolian"[^>]*>/i);
        section = parts[1] || html;
      }
      return [...section.matchAll(/<li>(.*?)<\/li>/g)]
        .map(m=>m[1].replace(/<[^>]+>/g,'').replace(/\s+/g,' ').trim())
        .filter(Boolean)
        .slice(0, 8);
    }catch{ return []; }
  }

  async function wiktSearch(q){
    try{
      const r = await fetch(`https://mn.wiktionary.org/w/api.php?action=opensearch&search=${encodeURIComponent(q)}&limit=1&namespace=0&format=json&origin=*`, { cache: 'no-store' });
      const j = await r.json();
      return j?.[1]?.[0] || null;
    }catch{ return null; }
  }

  async function translateToKo(text){
    try{
      const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=mn&tl=ko&dt=t&q=${encodeURIComponent(text)}`;
      const r = await fetch(url, { cache: 'no-store' });
      const j = await r.json();
      // join pieces
      if (Array.isArray(j) && Array.isArray(j[0])) {
        return j[0].map(x=>x[0]).join('');
      }
      return "";
    }catch(e){
      errEl.textContent = "번역 호출 실패(브라우저에서 차단될 수 있음).";
      return "";
    }
  }

  function escapeHtml(s){ return s.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;"); }
})();
</script>
</body>
</html>
