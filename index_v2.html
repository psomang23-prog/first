<!DOCTYPE html>
<html lang="mn">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ğ­Ñ…Ğ»ÑĞ» 1 â€” ëª½ê³¨ì–´ í´ë¦­ ì‚¬ì „ (HTMLë§Œ, v2)</title>
<style>
  :root {
    --bg: #ffffff;
    --text: #0f172a;
    --muted: #64748b;
    --brand: #16a34a; /* green to distinguish v2 */
    --panel: #f8fafc;
    --chip: #ecfdf5;
    --chip-border: #bbf7d0;
  }
  * { box-sizing: border-box; }
  body {
    margin: 0; padding: 16px 16px 160px;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans", "Apple SD Gothic Neo", "Malgun Gothic", "Helvetica Neue", Arial, "Noto Color Emoji", "Segoe UI Emoji", sans-serif;
    line-height: 1.8; color: var(--text); background: var(--bg);
  }
  h1 { margin: 0 0 4px; font-size: 22px; }
  .sub { margin: 0 0 12px; color: var(--muted); font-size: 13px; }
  #text { white-space: pre-wrap; font-size: 18px; }
  .word {
    cursor: pointer; padding: 2px 4px; border-radius: 6px;
    transition: background .12s ease;
  }
  .word:hover { background: #eef; }
  .sel { background: #e9ffee; outline: 1px solid #bbf7d0; }
  #toolbar {
    display:flex; gap:8px; align-items:center; flex-wrap: wrap;
    margin: 8px 0 14px;
  }
  .btn {
    appearance:none; border:1px solid #d1d5db; background:#fff; color:#111;
    padding:6px 10px; border-radius: 999px; font-size: 13px; cursor:pointer;
  }
  .btn:active { transform: translateY(1px); }
  .toggle { display:flex; align-items:center; gap:6px; font-size: 13px; color: var(--muted); }
  #panel {
    position: fixed; left: 0; right: 0; bottom: 0;
    border-top: 1px solid #e5e7eb; background: var(--panel);
    padding: 12px 16px; box-shadow: 0 -6px 18px rgba(0,0,0,.06);
  }
  #panel .w { font-weight: 800; font-size: 18px; }
  #chips { display:flex; gap:8px; flex-wrap:wrap; margin: 8px 0 0; }
  .chip {
    font-size: 12px; background: var(--chip); color:#065f46; border:1px solid var(--chip-border);
    padding: 4px 8px; border-radius: 999px;
  }
  #defs { margin-top: 6px; }
  #defs .def { padding: 3px 0; }
  #meta { margin-top: 8px; font-size: 12px; color: var(--muted); }
  .badge { font-size: 11px; background: #dcfce7; color:#065f46; border: 1px solid #86efac; padding: 2px 6px; border-radius: 999px; }
  footer { margin-top: 10px; font-size: 11px; color:#94a3b8; }
</style>
</head>
<body data-version="v2">
  <h1>Ğ­Ñ…Ğ»ÑĞ» 1 â€” ĞĞ‘2013 <span class="badge">v2</span></h1>
  <p class="sub">ë‹¨ì–´ë¥¼ íƒ­í•˜ë©´ ì•„ë˜ì— <strong>ëœ»</strong>ì´ ë°”ë¡œ ëœ¬ë‹¤. (ë°±ì—”ë“œ ì—†ìŒ / Wiktionary API / ë¡œì»¬ ìºì‹œ ê¸°ë³¸ 24ì‹œê°„)</p>

  <div id="toolbar">
    <label class="toggle">
      <input type="checkbox" id="useCache" checked />
      ìºì‹œ ì‚¬ìš©(24ì‹œê°„)
    </label>
    <button id="forceRefresh" class="btn">ì„ íƒ ë‹¨ì–´ ë‹¤ì‹œ ì¡°íšŒ</button>
    <button id="clearCache" class="btn">ìºì‹œ ëª¨ë‘ ì‚­ì œ</button>
  </div>

  <div id="text"></div>

  <div id="panel" hidden>
    <div class="w" id="w"></div>
    <div id="chips">
      <span class="chip" id="pos" style="display:none"></span>
      <span class="chip" id="lemma" style="display:none"></span>
      <span class="chip">ì¶œì²˜: Wiktionary</span>
    </div>
    <div id="defs"></div>
    <div id="meta"></div>
  </div>

  <footer>Version: <strong>2025-08-10 v2</strong> Â· ë¸Œë¼ìš°ì € ìºì‹œ/ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì˜í–¥ ë°›ìŒ</footer>

<script>
/* ------------------------- ì„¤ì • ------------------------- */
const CACHE_HOURS = 24; // ë°”ê¾¸ê³  ì‹¶ìœ¼ë©´ ì—¬ê¸° ì¡°ì ˆ
const CACHE_KEY_PREFIX = "mnv2:"; // v2ë¶€í„° í‚¤ í”„ë¦¬í”½ìŠ¤ ë³€ê²½(ì´ì „ ìºì‹œì™€ ì¶©ëŒ ë°©ì§€)
const CYRILLIC = /[\\u0400-\\u04FF]/;
const WORD_RE = /([\\u0400-\\u04FF]+)|(\\s+|[^\\u0400-\\u04FF]+)/g;

/* ------------------------- ë³¸ë¬¸ ------------------------- */
const textData = `[1] Ğ­Ñ…ÑĞ½Ğ´ Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ Ñ‚ÑĞ½Ğ³ÑÑ€ Ğ±Ğ° Ğ³Ğ°Ğ·Ñ€Ñ‹Ğ³ Ğ±Ò¯Ñ‚ÑÑĞ¶ÑÑ. [2] Ğ“Ğ°Ğ·Ğ°Ñ€ Ğ½ÑŒ Ñ…ÑĞ»Ğ±ÑÑ€Ğ¶ÑÑĞ³Ò¯Ğ¹, Ñ…Ğ¾Ğ¾ÑĞ¾Ğ½ Ñ‚Ó©Ğ´Ğ¸Ğ¹Ğ³Ò¯Ğ¹ Ğ¾Ñ‘Ğ¾Ñ€Ğ³Ò¯Ğ¹ Ğ³Ò¯Ğ½Ğ¸Ğ¹ Ğ³Ğ°Ğ´Ğ°Ñ€Ğ³ÑƒÑƒĞ´ Ñ…Ğ°Ñ€Ğ°Ğ½Ñ…ÑƒĞ¹ Ğ±Ò¯Ñ€Ñ…ÑĞ¶, Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½Ñ‹ Ğ¡Ò¯Ğ½Ñ ÑƒÑĞ½Ñ‹ Ğ¼Ğ°Ğ½Ğ´Ğ°Ğ» Ğ´ÑÑĞ³Ò¯Ò¯Ñ€ ÑĞ»Ğ¸Ğ½ Ñ…Ğ°Ğ»ÑŒĞ¶ Ğ±Ğ°Ğ¹Ğ»Ğ°Ğ°. [3] Ğ¢ÑĞ³ÑÑ…ÑĞ´ Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ â€”Ğ“ÑÑ€ÑĞ» Ğ±Ğ¸Ğ¹ Ğ±Ğ¾Ğ»Ñ‚ÑƒĞ³Ğ°Ğ¹! Ğ³ÑĞ¶ Ğ°Ğ¹Ğ»Ğ´ÑĞ°Ğ½Ğ´ Ğ³ÑÑ€ÑĞ» Ğ±Ğ¸Ğ¹ Ğ±Ğ¾Ğ»Ğ¾Ğ². [4] Ğ“ÑÑ€ÑĞ» ÑĞ°Ğ¹Ğ½ Ğ±Ğ¾Ğ»ÑĞ½Ñ‹Ğ³ Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ Ñ…Ğ°Ñ€Ğ¶, Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ Ğ³ÑÑ€Ğ»Ğ¸Ğ¹Ğ³ Ñ…Ğ°Ñ€Ğ°Ğ½Ñ…ÑƒĞ¹Ğ³Ğ°Ğ°Ñ ÑĞ°Ğ»Ğ³Ğ°Ğ¶ÑÑ. [5] Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ Ğ³ÑÑ€Ğ»Ğ¸Ğ¹Ğ³ Ó©Ğ´Ó©Ñ€ Ğ³ÑĞ¶ Ğ½ÑÑ€Ğ»ÑÑĞ´, Ñ…Ğ°Ñ€Ğ°Ğ½Ñ…ÑƒĞ¹Ğ³ ÑˆÓ©Ğ½Ó© Ğ³ÑĞ¶ Ğ½ÑÑ€Ğ»ÑĞ»ÑÑ. Ğ˜Ğ¹Ğ½ Ò¯Ğ´ÑÑˆ Ğ±Ğ¾Ğ»Ğ¾Ğ¾Ğ´, Ó©Ğ³Ğ»Ó©Ó© Ğ±Ğ¾Ğ»ÑĞ¾Ğ½ Ğ½ÑŒ Ğ°Ğ½Ñ…Ğ½Ñ‹ Ó©Ğ´Ó©Ñ€. [6] Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ â€”Ğ£ÑĞ½Ñ‹ Ğ´ÑƒĞ½Ğ´ÑƒÑƒÑ€ Ğ¾Ğ³Ñ‚Ğ¾Ñ€Ğ³ÑƒĞ¹ Ğ±Ğ°Ğ¹Ğ¶, Ğ¸Ğ¹Ğ½Ñ…Ò¯Ò¯ ÑƒÑÑ‹Ğ³ ÑƒÑĞ½Ğ°Ğ°Ñ ÑĞ°Ğ»Ğ³Ğ°Ñ‚ÑƒĞ³Ğ°Ğ¹! Ğ³ÑĞ¶ Ğ°Ğ¹Ğ»Ğ´Ğ°Ğ². [7] Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ Ğ¸Ğ½Ğ³ÑĞ¶ Ğ¾Ğ³Ñ‚Ğ¾Ñ€Ğ³ÑƒĞ¹Ğ³ Ğ±Ğ¸Ğ¹ Ğ±Ğ¾Ğ»Ğ³Ğ¾Ğ¾Ğ´, Ğ¾Ğ³Ñ‚Ğ¾Ñ€Ğ³ÑƒĞ¹Ğ½ Ğ´ÑÑÑ€Ñ… ÑƒÑĞ½Ğ°Ğ°Ñ Ğ¾Ğ³Ñ‚Ğ¾Ñ€Ğ³ÑƒĞ¹Ğ½ Ğ´Ğ¾Ğ¾Ñ€Ñ… ÑƒÑÑ‹Ğ³ ÑĞ°Ğ»Ğ³Ğ°ÑĞ°Ğ½Ğ´ Ñ‘ÑĞ¾Ğ¾Ñ€ Ğ±Ğ¾Ğ»Ğ¾Ğ². [8] Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ Ğ¾Ğ³Ñ‚Ğ¾Ñ€Ğ³ÑƒĞ¹Ğ³ Ñ‚ÑĞ½Ğ³ÑÑ€ Ğ³ÑĞ¶ Ğ½ÑÑ€Ğ»ÑĞ¶ÑÑ. Ò®Ğ´ÑÑˆ Ğ±Ğ¾Ğ»Ğ¾Ğ¾Ğ´, Ó©Ğ³Ğ»Ó©Ó© Ğ±Ğ¾Ğ»ÑĞ¾Ğ½ Ğ½ÑŒ Ñ…Ğ¾Ñ‘Ñ€ Ğ´Ğ°Ñ…ÑŒ Ó©Ğ´Ó©Ñ€. [9] Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ â€”Ğ¢ÑĞ½Ğ³ÑÑ€Ğ¸Ğ¹Ğ½ Ğ´Ğ¾Ğ¾Ñ€Ñ… ÑƒÑ Ğ½ÑĞ³ Ğ´Ğ¾Ñ€ Ñ…ÑƒÑ€Ğ¸Ğ¼Ñ‚Ğ»Ğ°Ğ³Ğ´Ğ°Ğ¶, Ğ¸Ğ¹Ğ½ Ñ…ÑƒÑƒÑ€Ğ°Ğ¹ Ğ³Ğ°Ğ·Ğ°Ñ€ Ğ¸Ğ» Ğ³Ğ°Ñ€Ñ‚ÑƒĞ³Ğ°Ğ¹! Ğ³ÑÑÑĞ½Ğ´ Ñ‘ÑĞ¾Ğ¾Ñ€ Ğ±Ğ¾Ğ»Ğ¶ÑÑ. [10] Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ Ñ…ÑƒÑƒÑ€Ğ°Ğ¹Ğ³ Ğ½ÑŒ Ğ³Ğ°Ğ·Ğ°Ñ€, Ñ…ÑƒÑ€Ğ¸Ğ¼Ñ‚Ğ»Ğ°Ğ³Ğ´ÑĞ°Ğ½ ÑƒÑÑ‹Ğ³ Ğ½ÑŒ Ğ´Ğ°Ğ»Ğ°Ğ¹ Ğ³ÑĞ¶ Ğ½ÑÑ€Ğ»ÑĞ². Ğ­Ğ´Ğ³ÑÑÑ€ Ğ½ÑŒ ÑĞ°Ğ¹Ğ½ Ğ±Ğ¾Ğ»ÑĞ½Ñ‹Ğ³ Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ Ñ…Ğ°Ñ€Ğ»Ğ°Ğ°. [11] Ğ˜Ğ½Ğ³ÑÑĞ´ Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ â€”Ğ“Ğ°Ğ·Ğ°Ñ€ Ğ½ÑŒ ÑƒÑ€Ğ³Ğ°Ğ¼Ğ°Ğ» Ğ½Ğ¾Ğ³Ğ¾Ğ¾Ğ³ Ğ±ÑƒÑÑƒ Ò¯Ñ€Ğ»ÑĞ³Ñ‡ Ó©Ğ²Ñ Ğ½Ğ¾Ğ³Ğ¾Ğ¾, Ğ´Ğ¾Ñ‚Ğ¾Ñ€Ñ… Ò¯Ñ€ÑÑ Ğ³Ğ°Ğ·Ğ°Ñ€Ñ‚ Ğ³Ó©Ğ²Ğ´Ó©Ğ³ Ò¯Ñ€ Ğ¶Ğ¸Ğ¼ÑÑ‚ Ğ¼Ğ¾Ğ´Ñ‹Ğ³ Ñ‚Ó©Ñ€Ó©Ğ» Ñ‚Ó©Ñ€Ğ»Ó©Ó©Ñ€ Ğ½ÑŒ ÑƒÑ€Ğ³ÑƒÑƒĞ»Ñ‚ÑƒĞ³Ğ°Ğ¹! Ğ³ÑĞ¶ Ğ°Ğ¹Ğ»Ğ´ÑĞ°Ğ½Ğ´ Ñ‘ÑĞ¾Ğ¾Ñ€ Ğ±Ğ¾Ğ»Ğ¶ÑÑ. [12] Ğ“Ğ°Ğ·Ğ°Ñ€ Ğ½ÑŒ Ğ¸Ğ¹Ğ½Ñ…Ò¯Ò¯ ÑƒÑ€Ğ³Ğ°Ğ¼Ğ°Ğ» Ğ½Ğ¾Ğ³Ğ¾Ğ¾Ğ³ Ğ±ÑƒÑÑƒ Ò¯Ñ€Ğ»ÑĞ³Ñ‡ Ó©Ğ²Ñ Ğ½Ğ¾Ğ³Ğ¾Ğ¾, Ğ´Ğ¾Ñ‚Ğ¾Ñ€Ñ… Ò¯Ñ€ÑÑ Ğ³Ğ°Ğ·Ğ°Ñ€Ñ‚ Ğ³Ó©Ğ²Ğ´Ó©Ğ³ Ò¯Ñ€ Ğ¶Ğ¸Ğ¼ÑÑ‚ Ğ¼Ğ¾Ğ´Ñ‹Ğ³ Ñ‚Ó©Ñ€Ó©Ğ» Ñ‚Ó©Ñ€Ğ»Ó©Ó©Ñ€ Ğ½ÑŒ Ğ³Ğ°Ñ€Ğ³Ğ°Ğ². Ğ­Ğ´Ğ³ÑÑÑ€ Ğ½ÑŒ ÑĞ°Ğ¹Ğ½ Ğ±Ğ¾Ğ»ÑĞ½Ñ‹Ğ³ Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ Ñ…Ğ°Ñ€Ğ»Ğ°Ğ°. [13] Ò®Ğ´ÑÑˆ Ğ±Ğ¾Ğ»Ğ¾Ğ¾Ğ´, Ó©Ğ³Ğ»Ó©Ó© Ğ±Ğ¾Ğ»ÑĞ¾Ğ½ Ğ½ÑŒ Ğ³ÑƒÑ€Ğ°Ğ² Ğ´Ğ°Ñ…ÑŒ Ó©Ğ´Ó©Ñ€. [14] Ğ¢ÑĞ³ÑÑĞ´ Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ â€”Ó¨Ğ´Ñ€Ğ¸Ğ¹Ğ³ ÑˆÓ©Ğ½Ó©Ó©Ñ ÑĞ°Ğ»Ğ³Ğ°Ñ…Ñ‹Ğ½ Ñ‚ÑƒĞ»Ğ´ Ñ‚ÑĞ½Ğ³ÑÑ€ Ğ¾Ğ³Ñ‚Ğ¾Ñ€Ğ³ÑƒĞ¹Ğ´ Ğ³ÑÑ€ÑĞ»Ñ‚Ò¯Ò¯Ğ»ÑĞ³Ñ‡Ğ¸Ğ´ Ğ±Ğ°Ğ¹Ñ… Ğ±Ğ¾Ğ»Ñ‚ÑƒĞ³Ğ°Ğ¹! Ğ­Ğ´Ğ³ÑÑÑ€ Ğ½ÑŒ Ñ‚ÑĞ¼Ğ´ÑĞ³, ÑƒĞ»Ğ¸Ñ€Ğ°Ğ», Ó©Ğ´Ó©Ñ€, Ğ¶Ğ¸Ğ»Ğ¸Ğ¹Ğ½ Ñ‚ÑƒĞ»Ğ´ Ğ±Ğ°Ğ¹Ğ³. [15] Ğ¢ÑĞ½Ğ³ÑÑ€ Ğ¾Ğ³Ñ‚Ğ¾Ñ€Ğ³ÑƒĞ¹Ğ´ Ğ³ÑÑ€ÑĞ»Ñ‚Ò¯Ò¯Ğ»ÑĞ³Ñ‡Ğ¸Ğ´ Ğ±Ğ°Ğ¹Ğ¶ Ğ³Ğ°Ğ·Ğ°Ñ€ Ğ´ÑĞ»Ñ…Ğ¸Ğ¹Ğ³ Ğ³Ğ¸Ğ¹Ğ³Ò¯Ò¯Ğ»ÑĞ³! Ğ³ÑĞ¶ Ğ°Ğ¹Ğ»Ğ´ÑĞ°Ğ½Ğ´ Ñ‘ÑĞ¾Ğ¾Ñ€ Ğ±Ğ¾Ğ»Ğ¶ÑÑ. [16] Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ Ó©Ğ´Ñ€Ğ¸Ğ¹Ğ³ Ğ·Ğ°Ñ…Ğ¸Ñ€ÑƒÑƒĞ»Ğ°Ñ…Ğ°Ğ°Ñ€ Ğ½ÑĞ³ Ñ‚Ğ¾Ğ¼Ñ…Ğ¾Ğ½ Ğ³ÑÑ€ÑĞ»Ñ‚Ò¯Ò¯Ğ»ÑĞ³Ñ‡, ÑˆÓ©Ğ½Ğ¸Ğ¹Ğ³ Ğ·Ğ°Ñ…Ğ¸Ñ€ÑƒÑƒĞ»Ğ°Ñ…Ğ°Ğ°Ñ€ Ğ°Ñ€Ğ°Ğ¹ Ğ±Ğ°Ğ³Ğ°Ğ²Ñ‚Ğ°Ñ€ Ğ³ÑÑ€ÑĞ»Ñ‚Ò¯Ò¯Ğ»ÑĞ³Ñ‡, Ğ¸Ğ¹Ğ¼ Ñ…Ğ¾Ñ‘Ñ€ Ñ‚Ğ¾Ğ¼ Ğ³ÑÑ€ÑĞ»Ñ‚Ò¯Ò¯Ğ»ÑĞ³Ñ‡Ğ¸Ğ¹Ğ³ Ğ¼Ó©Ğ½ Ğ¾Ğ´Ğ´Ñ‹Ğ³ Ğ±Ğ¸Ğ¹ Ğ±Ğ¾Ğ»Ğ³Ğ¾Ğ². [17] Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ Ñ‚ÑĞ´Ğ³ÑÑÑ€ÑÑÑ€ Ğ³Ğ°Ğ·Ğ°Ñ€ Ğ´ÑĞ»Ñ…Ğ¸Ğ¹Ğ³ Ğ³ÑÑ€ÑĞ»Ñ‚Ò¯Ò¯Ğ»ÑÑ…ÑÑÑ€ Ñ‚ÑĞ½Ğ³ÑÑ€ Ğ¾Ğ³Ñ‚Ğ¾Ñ€Ğ³ÑƒĞ¹Ğ´ Ñ‚Ğ°Ğ²ÑŒÑĞ°Ğ½ Ğ½ÑŒ [18] Ó©Ğ´Ó©Ñ€, ÑˆÓ©Ğ½Ó© Ñ…Ğ¾Ñ‘Ñ€Ñ‹Ğ³ Ğ·Ğ°Ñ…Ğ¸Ñ€ÑƒÑƒĞ»Ğ°Ñ… Ğ±Ğ°Ñ Ğ³ÑÑ€Ğ»Ğ¸Ğ¹Ğ³ Ñ…Ğ°Ñ€Ğ°Ğ½Ñ…ÑƒĞ¹Ğ³Ğ°Ğ°Ñ ÑĞ°Ğ»Ğ³Ğ°Ñ…Ñ‹Ğ½ Ñ‚ÑƒĞ»Ğ´ Ğ°Ğ¶Ğ³ÑƒÑƒ. Ğ­Ğ´Ğ³ÑÑÑ€ Ğ½ÑŒ ÑĞ°Ğ¹Ğ½ Ğ±Ğ¾Ğ»ÑĞ½Ñ‹Ğ³ Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ Ñ…Ğ°Ñ€Ğ»Ğ°Ğ°. [19] Ò®Ğ´ÑÑˆ Ğ±Ğ¾Ğ»Ğ¾Ğ¾Ğ´, Ó©Ğ³Ğ»Ó©Ó© Ğ±Ğ¾Ğ»ÑĞ¾Ğ½ Ğ½ÑŒ Ğ´Ó©Ñ€Ó©Ğ² Ğ´ÑÑ… Ó©Ğ´Ó©Ñ€. [20] Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ â€”Ğ¨ÑƒĞ½Ğ³Ğ°Ğ½ ÑˆÑƒĞ¼Ğ±Ğ°Ğ³Ñ‡ Ğ°Ğ¼ÑŒĞ´ Ğ±Ğ¸ĞµÑ‚ÑÑÑ€ ÑƒÑĞ½ÑƒÑƒĞ´ Ñ†Ğ°Ğ»Ğ³Ğ¸Ğ»Ñ‚ÑƒĞ³Ğ°Ğ¹, Ğ±Ğ°Ñ ÑˆÑƒĞ²ÑƒÑƒĞ´ Ğ³Ğ°Ğ·Ğ°Ñ€ Ğ´ÑĞ»Ñ…Ğ¸Ğ¹ Ğ´ÑÑĞ³Ò¯Ò¯Ñ€, Ñ‚ÑĞ½Ğ³ÑÑ€ Ğ¾Ğ³Ñ‚Ğ¾Ñ€Ğ³ÑƒĞ¹Ğ½ Ğ¼Ğ°Ğ½Ğ´Ğ°Ğ»Ğ´ Ğ½Ğ¸ÑÑ‚Ò¯Ğ³ÑĞ¹! Ğ³ÑĞ¶ Ğ°Ğ¹Ğ»Ğ´Ğ°Ğ². [21] Ğ˜Ğ¹Ğ½Ñ…Ò¯Ò¯ Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ Ğ´Ğ°Ğ»Ğ°Ğ¹ Ñ‚ÑĞ½Ğ³Ğ¸ÑĞ¸Ğ¹Ğ½ Ğ°Ğ²Ğ°Ñ€Ğ³Ğ° Ñ‚Ğ¾Ğ¼ Ğ°Ğ¼ÑŒÑ‚Ğ°Ğ´ Ğ±Ğ° ÑƒÑĞ½Ğ°Ğ° ÑˆÑƒĞ½Ğ³Ğ°Ğ½ ÑˆÑƒĞ¼Ğ±Ğ°Ğ³Ñ‡ Ğ°Ğ¼ÑŒĞ´ Ğ±Ğ¸ĞµÑ‚Ğ¸Ğ¹Ğ³ Ñ‚Ó©Ñ€Ó©Ğ» Ñ‚Ó©Ñ€Ğ»Ó©Ó©Ñ€ Ğ½ÑŒ Ğ±Ğ°Ñ Ğ°Ğ»Ğ¸Ğ²Ğ°Ğ° Ğ¶Ğ¸Ğ³Ò¯Ò¯Ñ€Ñ‚ÑĞ½ ÑˆÑƒĞ²ÑƒÑƒĞ´Ñ‹Ğ³ Ñ‚Ó©Ñ€Ó©Ğ» Ñ‚Ó©Ñ€Ğ»Ó©Ó©Ñ€ Ğ½ÑŒ Ğ±Ò¯Ñ‚ÑÑĞ². Ğ­Ğ´Ğ³ÑÑÑ€ Ğ½ÑŒ ÑĞ°Ğ¹Ğ½ Ğ±Ğ¾Ğ»ÑĞ½Ñ‹Ğ³ Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ Ñ…Ğ°Ñ€Ğ»Ğ°Ğ°. [22] Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ Ñ‚ÑĞ´Ğ½Ğ¸Ğ¹Ğ³ ĞµÑ€Ó©Ó©Ğ½ â€”Ò®Ñ€Ğ¶Ğ¸Ğ¶, Ğ¾Ğ»ÑˆĞ¸Ñ€Ñ†Ğ³Ğ¾Ğ¾Ğ³! Ğ”Ğ°Ğ»Ğ°Ğ¹ Ñ‚ÑĞ½Ğ³Ğ¸ÑĞ¸Ğ¹Ğ½ ÑƒÑĞ°Ğ½Ğ´ Ğ´Ò¯Ò¯Ñ€Ñ†Ğ³ÑÑĞ³! Ğ¨ÑƒĞ²ÑƒÑƒĞ´ Ñ‡ Ğ³Ğ°Ğ·Ğ°Ñ€ Ğ´ÑĞ»Ñ…Ğ¸Ğ¹Ğ´ Ğ¾Ğ»ÑˆĞ¸Ñ€Ñ†Ğ³Ğ¾Ğ¾Ğ³! Ñ…ÑĞ¼ÑÑĞ². [23] Ò®Ğ´ÑÑˆ Ğ±Ğ¾Ğ»Ğ¾Ğ¾Ğ´, Ó©Ğ³Ğ»Ó©Ó© Ğ±Ğ¾Ğ»ÑĞ¾Ğ½ Ğ½ÑŒ Ñ‚Ğ°Ğ² Ğ´Ğ°Ñ…ÑŒ Ó©Ğ´Ó©Ñ€. [24] Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ â€”Ğ“Ğ°Ğ·Ğ°Ñ€ Ğ´ÑĞ»Ñ…Ğ¸Ğ¹ Ğ°Ğ¼ÑŒĞ´ Ğ±Ğ¸ĞµÑ‚Ğ¸Ğ¹Ğ³ Ñ‚Ó©Ñ€Ó©Ğ» Ñ‚Ó©Ñ€Ğ»Ó©Ó©Ñ€ Ğ½ÑŒ Ğ±ÑƒÑÑƒ Ğ¼Ğ°Ğ» Ğ°Ğ´Ğ³ÑƒÑƒÑ, Ğ¼Ó©Ğ»Ñ…Ó©Ğ³Ñ‡Ğ¸Ğ´, Ğ³Ğ°Ğ·Ñ€Ñ‹Ğ½ Ğ·ÑÑ€Ğ»ÑĞ³ Ğ°Ğ¼ÑŒÑ‚Ğ´Ñ‹Ğ³ Ñ‚Ó©Ñ€Ó©Ğ» Ñ‚Ó©Ñ€Ğ»Ó©Ó©Ñ€ Ğ½ÑŒ Ğ³Ğ°Ñ€Ğ³Ğ°Ñ‚ÑƒĞ³Ğ°Ğ¹! Ğ³ÑĞ¶ Ğ°Ğ¹Ğ»Ğ´ÑĞ°Ğ½Ğ´ Ñ‘ÑĞ¾Ğ¾Ñ€ Ğ±Ğ¾Ğ»Ğ¶ÑÑ. [25] Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ Ğ¸Ğ¹Ğ½Ñ…Ò¯Ò¯ Ğ³Ğ°Ğ·Ñ€Ñ‹Ğ½ Ğ·ÑÑ€Ğ»ÑĞ³ Ğ°Ğ¼ÑŒÑ‚Ğ´Ñ‹Ğ³ Ñ‚Ó©Ñ€Ó©Ğ» Ñ‚Ó©Ñ€Ğ»Ó©Ó©Ñ€ Ğ½ÑŒ, Ğ¼Ğ°Ğ» Ğ°Ğ´Ğ³ÑƒÑƒÑÑ‹Ğ³ Ñ‚Ó©Ñ€Ó©Ğ» Ñ‚Ó©Ñ€Ğ»Ó©Ó©Ñ€ Ğ½ÑŒ, Ğ³Ğ°Ğ·Ñ€Ğ°Ğ°Ñ€ Ğ¼Ó©Ğ»Ñ…Ó©Ğ³Ñ‡ Ğ±Ò¯Ğ³Ğ´Ğ¸Ğ¹Ğ³ Ñ‚Ó©Ñ€Ó©Ğ» Ñ‚Ó©Ñ€Ğ»Ó©Ó©Ñ€ Ğ½ÑŒ Ğ±Ğ¸Ğ¹ Ğ±Ğ¾Ğ»Ğ³Ğ¾Ğ². Ğ­Ğ´Ğ³ÑÑÑ€ Ğ½ÑŒ ÑĞ°Ğ¹Ğ½ Ğ±Ğ¾Ğ»ÑĞ½Ñ‹Ğ³ Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ Ñ…Ğ°Ñ€Ğ»Ğ°Ğ°. [26] Ğ¢ÑĞ³ÑÑĞ´ Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ â€”Ğ‘Ğ¸Ğ´ Ğ´Ò¯Ñ€ Ñ‚Ó©Ñ€Ñ…Ğ¸Ğ¹Ğ½Ñ…Ó©Ó© Ğ´Ğ°Ğ³ÑƒÑƒ Ğ±Ğ¸Ğ´ÑĞ½Ñ‚ÑĞ¹ Ğ°Ğ´Ğ¸Ğ»Ñ…Ğ°Ğ½ Ñ…Ò¯Ğ½Ğ¸Ğ¹Ğ³ Ğ±ÑƒĞ¹ Ğ±Ğ¾Ğ»Ğ³Ğ¾Ñ‘. Ğ¢ÑĞ³ÑÑĞ´ Ñ‚ÑĞ´Ğ½ÑÑÑ€ Ğ´Ğ°Ğ»Ğ°Ğ¹Ğ½ Ğ·Ğ°Ğ³Ğ°Ñ, Ğ¾Ğ³Ñ‚Ğ¾Ñ€Ğ³ÑƒĞ¹Ğ½ ÑˆÑƒĞ²ÑƒÑƒĞ´, Ğ¼Ğ°Ğ» Ğ°Ğ´Ğ³ÑƒÑƒÑ, Ğ±Ò¯Ñ… Ğ³Ğ°Ğ·Ğ°Ñ€ Ğ´ÑĞ»Ñ…Ğ¸Ğ¹, Ğ³Ğ°Ğ·Ñ€Ğ°Ğ°Ñ€ Ğ¼Ó©Ğ»Ñ…Ğ´Ó©Ğ³ Ğ¼Ó©Ğ»Ñ…Ó©Ğ³Ñ‡ Ğ±Ò¯Ğ³Ğ´Ğ¸Ğ¹Ğ³ Ğ·Ğ°Ñ…Ğ¸Ñ€ÑƒÑƒĞ»ÑŠÑ Ğ³ÑĞ¶ Ğ°Ğ¹Ğ»Ğ´Ğ°Ğ². [27] Ğ˜Ğ¹Ğ½Ñ…Ò¯Ò¯ Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ Ó¨Ó©Ñ€Ğ¸Ğ¹Ğ½Ñ…Ó©Ó© Ğ´Ò¯Ñ€ Ñ‚Ó©Ñ€Ñ…Ó©Ó©Ñ€ Ñ…Ò¯Ğ½Ğ¸Ğ¹Ğ³ Ğ±Ò¯Ñ‚ÑÑĞ¶, Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½Ñ‹ Ğ´Ò¯Ñ€ Ñ‚Ó©Ñ€Ñ…Ó©Ó©Ñ€ Ğ±Ò¯Ñ‚ÑÑÑ…Ğ´ÑÑ ÑÑ€ ÑĞ¼ÑÑÑ€ Ğ½ÑŒ Ğ±Ò¯Ñ‚ÑÑĞ¶ÑÑ. [28] Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ Ñ‚ÑĞ´Ğ½Ğ¸Ğ¹Ğ³ ĞµÑ€Ó©Ó©Ğ¶ â€”Ò®Ñ€Ğ¶Ğ¸Ğ¶, Ğ¾Ğ»ÑˆĞ¸Ñ€Ñ†Ğ³Ğ¾Ğ¾Ğ³! Ğ“Ğ°Ğ·Ğ°Ñ€ Ğ´ÑĞ»Ñ…Ğ¸Ğ¹Ğ³ Ğ´Ò¯Ò¯Ñ€Ğ³ÑĞ¶, Ñ‚Ò¯Ò¯Ğ½Ğ¸Ğ¹Ğ³ ÑĞ·ÑĞ¼ÑˆĞ¸Ñ†Ğ³ÑÑĞ³! Ğ”Ğ°Ğ»Ğ°Ğ¹Ğ½ Ğ·Ğ°Ğ³Ğ°Ñ, Ğ¾Ğ³Ñ‚Ğ¾Ñ€Ğ³ÑƒĞ¹Ğ½ ÑˆÑƒĞ²ÑƒÑƒĞ´ Ñ…Ğ¸Ğ¹Ğ³ÑÑĞ´ Ğ³Ğ°Ğ·Ğ°Ñ€ Ğ´ÑÑÑ€ Ñ…Ó©Ğ»Ñ…Ó©Ğ³Ñ‡ Ğ°Ğ¼ÑŒÑ‚Ğ°Ğ½ Ğ±Ò¯Ñ…Ğ½Ğ¸Ğ¹Ğ³ Ğ·Ğ°Ñ…Ğ¸Ñ€Ñ†Ğ³Ğ°Ğ°Ğ³! Ğ³ÑĞ². [29] Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ â€”Ò®Ğ·ÑĞ³Ñ‚Ò¯Ğ½, Ğ³Ğ°Ğ·Ñ€Ñ‹Ğ½ Ğ³Ğ°Ğ´Ğ°Ñ€Ğ³Ğ° Ğ´ÑÑÑ€Ñ… Ò¯Ñ€Ñ‚ Ó©Ğ²Ñ Ğ½Ğ¾Ğ³Ğ¾Ğ¾ Ğ±Ò¯Ñ€Ğ¸Ğ¹Ğ³, Ò¯Ñ€ÑÑ Ğ³Ó©Ğ²Ğ´Ó©Ğ³ Ò¯Ñ€ Ğ¶Ğ¸Ğ¼ÑÑ‚ Ğ¼Ğ¾Ğ´ Ğ±Ò¯Ğ³Ğ´Ğ¸Ğ¹Ğ³ Ğ‘Ğ¸ Ñ‚Ğ° Ğ½Ğ°Ñ€Ñ‚ Ó©Ğ³Ğ½Ó©. Ğ¢ÑÑ€ Ğ±Ò¯Ñ…ÑĞ½ Ñ‚Ğ° Ğ½Ğ°Ñ€Ñ‹Ğ½ Ñ…Ğ¾Ğ¾Ğ» Ñ…Ò¯Ğ½Ñ Ğ±Ğ¾Ğ»Ğ½Ğ¾. [30] Ğ“Ğ°Ğ·Ğ°Ñ€ Ğ´ÑĞ»Ñ…Ğ¸Ğ¹Ğ½ Ğ·ÑÑ€Ğ»ÑĞ³ Ğ°Ğ¼ÑŒÑ‚Ğ°Ğ½ Ğ±Ò¯Ñ…ÑĞ½Ğ´, Ğ¾Ğ³Ñ‚Ğ¾Ñ€Ğ³ÑƒĞ¹Ğ½ ÑˆÑƒĞ²ÑƒÑƒ Ğ±Ò¯Ñ…ÑĞ½Ğ´, Ğ³Ğ°Ğ·Ñ€Ğ°Ğ°Ñ€ Ğ¼Ó©Ğ»Ñ…Ó©Ğ³Ñ‡ Ğ±Ò¯Ñ…ÑĞ½Ğ´, Ğ°Ğ¼ÑŒÑ‚Ğ°Ğ¹ Ğ°Ğ¼ÑŒÑĞ³Ğ°Ğ»Ñ‚Ğ°Ğ¹ Ğ±Ò¯Ñ…ÑĞ½Ğ´ Ó©Ğ²Ñ Ğ½Ğ¾Ğ³Ğ¾Ğ¾ Ğ±Ò¯Ğ³Ğ´Ğ¸Ğ¹Ğ³ Ñ…Ğ¾Ğ¾Ğ» Ñ…Ò¯Ğ½Ñ Ğ±Ğ¾Ğ»Ğ³Ğ¾Ğ¶ Ó©Ğ³ÑŒĞµ Ğ³ÑÑÑĞ½Ğ´ Ñ‘ÑĞ¾Ğ¾Ñ€ Ğ±Ğ¾Ğ»Ğ¶ÑÑ. [31] Ó¨Ó©Ñ€Ğ¸Ğ¹Ğ½Ñ… Ğ½ÑŒ Ğ±ÑƒĞ¹ Ğ±Ğ¾Ğ»Ğ³Ğ¾ÑĞ¾Ğ½ Ğ±Ò¯Ğ³Ğ´ Ğ½ÑĞ½ ÑĞ°Ğ¹Ğ½ Ğ±Ğ¾Ğ»ÑĞ½Ñ‹Ğ³ Ğ‘ÑƒÑ€Ñ…Ğ°Ğ½ Ñ…Ğ°Ñ€Ğ»Ğ°Ğ°. Ò®Ğ´ÑÑˆ Ğ±Ğ¾Ğ»Ğ¾Ğ¾Ğ´, Ó©Ğ³Ğ»Ó©Ó© Ğ±Ğ¾Ğ»ÑĞ¾Ğ½ Ğ½ÑŒ Ğ·ÑƒÑ€Ğ³Ğ°Ğ° Ğ´Ğ°Ñ…ÑŒ Ó©Ğ´Ó©Ñ€.`;

/* ------------------------- ë Œë”ë§ ------------------------- */
const textEl = document.getElementById("text");
let currentSel = null;

function renderText() {
  const frag = document.createDocumentFragment();
  const it = textData.matchAll(WORD_RE);
  for (const m of it) {
    const w = m[1];
    const other = m[2];
    if (w) {
      const span = document.createElement("span");
      span.textContent = w;
      span.className = "word";
      span.dataset.raw = w;
      span.addEventListener("click", () => onWordClick(span));
      frag.appendChild(span);
    } else {
      frag.appendChild(document.createTextNode(other));
    }
  }
  textEl.innerHTML = "";
  textEl.appendChild(frag);
}
renderText();

/* ------------------------- ì¡°íšŒ/ìºì‹œ/ë Œë” ------------------------- */
const useCacheEl = document.getElementById("useCache");
const forceBtn = document.getElementById("forceRefresh");
const clearBtn = document.getElementById("clearCache");

forceBtn.onclick = () => {
  if (!currentSel) return;
  const word = (currentSel.dataset.raw || "").trim();
  // ê°•ì œ ì¬ì¡°íšŒ: ìºì‹œ ì‚­ì œ í›„ ì¡°íšŒ
  localStorage.removeItem(cacheKey(word));
  onWordClick(currentSel, { force: true });
};
clearBtn.onclick = () => {
  Object.keys(localStorage)
    .filter(k => k.startsWith(CACHE_KEY_PREFIX))
    .forEach(k => localStorage.removeItem(k));
  alert("ìºì‹œë¥¼ ëª¨ë‘ ì‚­ì œí–ˆì–´!");
};

function cacheKey(w){ return `${CACHE_KEY_PREFIX}${w.toLowerCase()}`; }

async function onWordClick(el, opts={}){
  const word = normalize(el.dataset.raw || "");
  if (!word || !CYRILLIC.test(word)) return;

  // ì„ íƒ í•˜ì´ë¼ì´íŠ¸
  if (currentSel) currentSel.classList.remove("sel");
  el.classList.add("sel");
  currentSel = el;

  const key = cacheKey(word);
  const cached = JSON.parse(localStorage.getItem(key) || "null");
  const cacheEnabled = useCacheEl.checked;

  if (cacheEnabled && !opts.force && cached && Date.now() - cached.t < CACHE_HOURS*3600*1000) {
    return renderDefs(word, cached.data);
  }

  // Wiktionary MN â†’ EN#Mongolian ìˆœì„œ ì‹œë„
  let data = await fetchWikt(
    `https://mn.wiktionary.org/w/api.php?action=parse&prop=text&page=${encodeURIComponent(word)}&format=json&origin=*`,
    "Wiktionary (mn)",
    `https://mn.wiktionary.org/wiki/${encodeURIComponent(word)}`
  );
  if (!data || (data.senses||[]).length === 0) {
    data = await fetchWikt(
      `https://en.wiktionary.org/w/api.php?action=parse&prop=text&page=${encodeURIComponent(word)}&format=json&origin=*`,
      "Wiktionary (en)#Mongolian",
      `https://en.wiktionary.org/wiki/${encodeURIComponent(word)}#Mongolian`,
      true
    );
  }
  if (cacheEnabled) {
    localStorage.setItem(key, JSON.stringify({ t: Date.now(), data }));
  }
  renderDefs(word, data);
}

async function fetchWikt(apiUrl, sourceName, sourceUrl, needMongolian=false){
  try{
    // cache: 'no-store'ë¡œ ë„¤íŠ¸ì›Œí¬ ê°•ì œ (ë¸Œë¼ìš°ì € ìºì‹œ ìš°íšŒ)
    const r = await fetch(apiUrl, { cache: 'no-store' });
    const j = await r.json();
    const html = j?.parse?.text?.["*"] || "";
    if (!html) return { lemmas:[], pos:null, senses:[], source:{name:sourceName,url:sourceUrl} };

    // ì„¹ì…˜ ì„ íƒ
    let section = html;
    if (needMongolian) {
      const parts = html.split(/<span[^>]*id="Mongolian"[^>]*>/i);
      section = parts[1] || html;
    }

    // POS ì¶”ì¶œ(ê°„ë‹¨)
    let pos = null;
    const posMatch = section.match(/<span class="mw-headline"[^>]*>(Noun|Verb|Adjective|Adverb|Pronoun|Numeral|Particle|Conjunction|Preposition)<\/span>/i);
    if (posMatch) pos = posMatch[1];

    // ì •ì˜: Mongolian ì„¹ì…˜ ì²« ë²ˆì§¸ <ol>/<ul> ì•ˆì˜ <li> ìš°ì„  ì¶”ì¶œ ì‹œë„
    let senses = [];
    const listMatch = section.match(/<(ol|ul)[^>]*>([\s\S]*?)<\/\1>/i);
    if (listMatch) {
      senses = [...listMatch[2].matchAll(/<li>(.*?)<\/li>/g)]
        .map(m=>cleanHtml(m[1]))
        .filter(Boolean);
    }
    // ë³´ì¡° ì¶”ì¶œ(ì—†ìœ¼ë©´ ì „ì²´ì—ì„œ li ìˆ˜ì§‘)
    if (senses.length === 0) {
      senses = [...section.matchAll(/<li>(.*?)<\/li>/g)]
        .map(m=>cleanHtml(m[1]))
        .filter(Boolean);
    }
    senses = senses.slice(0, 10);

    const lemmas = [ (j?.parse?.title || "").trim() ].filter(Boolean);

    return { lemmas, pos, senses, source:{name:sourceName, url:sourceUrl} };
  }catch(e){
    return { lemmas:[], pos:null, senses:[], source:{name:sourceName,url:sourceUrl}, error: String(e) };
  }
}

function normalize(token){
  return token.replace(/^[â€”â€“\-â€“â€”.,!?;:()\[\]Â«Â»"â€œâ€â€˜â€™]+|[â€”â€“\-â€“â€”.,!?;:()\[\]Â«Â»"â€œâ€â€˜â€™]+$/g,"").trim();
}
function cleanHtml(s){
  return s.replace(/<[^>]+>/g,'').replace(/\s+/g,' ').trim();
}

/* ------------------------- ë Œë” ------------------------- */
const panelEl = document.getElementById("panel");
const wEl = document.getElementById("w");
const posEl = document.getElementById("pos");
const lemmaEl = document.getElementById("lemma");
const defsEl = document.getElementById("defs");
const metaEl = document.getElementById("meta");

function renderDefs(originalWord, payload){
  panelEl.hidden = false;
  const lemma = (payload?.lemmas && payload.lemmas[0]) || originalWord;

  wEl.textContent = lemma;
  if (payload?.pos) { posEl.textContent = payload.pos; posEl.style.display = "inline-block"; }
  else { posEl.style.display = "none"; }
  if (lemma && lemma !== originalWord) { lemmaEl.textContent = `ì›í˜•: ${lemma}`; lemmaEl.style.display = "inline-block"; }
  else { lemmaEl.style.display = "none"; }

  defsEl.innerHTML = (payload?.senses||[]).length
    ? payload.senses.map(s=>`<div class="def">â€¢ ${escapeHtml(s)}</div>`).join("")
    : `<div class="def">ëœ»ì„ ëª» ì°¾ì•˜ì–´ ğŸ˜¢ (ì¶œì²˜ í˜ì´ì§€ì—ì„œ ì§ì ‘ í™•ì¸í•´ë´)</div>`;

  const src = payload?.source;
  const when = new Date().toLocaleString();
  metaEl.innerHTML = src
    ? `ì¶œì²˜: <a href="${src.url}" target="_blank" rel="noopener">${escapeHtml(src.name)}</a> Â· ì¡°íšŒ: ${when}`
    : `ì¡°íšŒ: ${when}`;
}

function escapeHtml(s){
  return s.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;");
}
</script>
</body>
</html>
